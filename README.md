# Crater Detection tool

### Installation Guide

By using the command: 
```
pip install ApolloCraterDetectionTool
```

### User instructions

### ðŸ“–Package
After installation, download the model(.pt file) using the download_models.py. 

First, in terminal, 
```
cd package_path + '/DetectionTool'
```

Next, run the 

```
python download_models.py
```

Then it would download a models documnet in the same path, which includes Mars_best.pt, Moon_Left_Model.pt, and Moon_Right_Model.pt files.

Then add the module by running in python:
```
from DetectionTool import *
```

Congratulation, now you can use the models to detecte the crater in two ways.
## 1.UI.py
![Image]("https://github.com/ese-msc-2022/acds-moonshot-apollo/blob/Inputed-image-processing/Img/UIInterface.png")

## 2.CraterPredictor Class
Adownload

To begin with, you can create an object named detection:
```
detection = CraterPredictor(mars_model, moon_model1, moon_model2, results_path, test_images_path, test_labels_path, img_size)
```
mars_model is string of path to the mars model weights, moon_model1, moon_model2: string of path to the moon model weights, results_path is string of path to the directory to store the results for the user, test_images_path is the str path to the directory containing the test images, test_labels_path is the string of path to the directory containing the test labels, optionally given by the user, and img_size is the size of the input images.



### Model class
This class is about the model detection

```
detection.predict_moon_craters_large_images(images)
```
This function would slice a large image into the size we want and be saved in the document file, and then be put to detection.

Then in detection, two models could be selected, one is moon model and another is mars.

```
detection.predict_moon_craters(images)
```
Use this function could let function to detect the whole images and return a csv. file in user_directory/detections.file using the moon model.

```
detection.predict_mars_craters(images)
```
Use this function could let function to detect the whole images and return a csv. file in user_directory/detections.file using the moon model.

```
detection.draw_boxes(label_path=None)
```
Use this result to D=draw bounding boxes on images, both ground truth (if provided) and detections and results are saved in 'results_path/images/detections' and 'results_path/images/detections_and_gt'.

```
detection.get_statistics(self, label_path=None):
```
Use this function would save the true positive (tp), false positive (fp), and false negative (fn) values to a csv file. label_path (str): The path to the directory containing the label csv files. If not specified, the function returns without performing any operations.


### Analysis and Visualization class
```
convert2physical(img_phy, img_pix, labels, subimg_pix, indices)
```
The function is to return the location (lat, lot) based on the information igven by user. `img_phy` is a set of parameters containing real-world, physical image center longitude,latitude, image width, height in degrees, and resolution. `img_pix` represents the number of pixels in each picture. `labels` means the predicted location and size of craters in the picture. `subimg_pix` is the number of pixels in each sub-picture, and `indices`  is the indices of different sub-pictures.

```
size_frequency_plot(crater_size)
```
From this function, we can plot a separate plot of the cumulative crater size-frequency distribution of detected craters, if information the `crater size` is provided.



### Documentation

The code includes [Sphinx](https://www.sphinx-doc.org) documentation. On systems with Sphinx installed, this can be build by running

```
python -m sphinx docs html
```

then viewing the generated `index.html` file in the `html` directory in your browser.

For systems with [LaTeX](https://www.latex-project.org/get/) installed, a manual pdf can be generated by running

```bash
python -m sphinx  -b latex docs latex
```

Then following the instructions to process the `CraterDetectionTool.tex` file in the `latex` directory in your browser.

### Testing

The tool includes several tests, which you can use to check its operation on your system. With [pytest](https://doc.pytest.org/en/latest) installed, these can be run with

```bash
python -m pytest --doctest-modules flood_tool
```

Additionally, we write a test to check our tool.py. You can use it first cd the folder *tests*, and run the **test_tool.py**.

### Reading list

 - (Description of lunar impact crater database Robbins, 2019.)
[https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2018JE005592]

 - (Yolvo5 Model description)
[https://github.com/ultralytics/yolov5/wiki/Train-Custom-Data]

 - (Equirectangular projection descripition)[https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/283357/ILRSpecification2013_14Appendix_C_Dec2012_v1.pdf]
 
 
 
 ### Lisence
 
 MIT[https://opensource.org/licenses/MIT]
 
 